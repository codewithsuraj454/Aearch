<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aearch</title>
<link href="https://fonts.googleapis.com/css2?family=Product+Sans:wght@400;500;700&family=Roboto:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Roboto', sans-serif;
  background: #fff;
  color: #202124;
}

/* Header */
header {
  padding: 20px 30px;
  border-bottom: 1px solid #dadce0;
  position: sticky;
  top: 0;
  background: #fff;
  z-index: 100;
}

.header-content {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  gap: 30px;
}

.logo {
  font-size: 22px;
  font-weight: 700;
  font-family: 'Product Sans', sans-serif;
  background: linear-gradient(90deg, #4285f4, #ea4335, #fbbc04, #34a853);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  cursor: pointer;
  white-space: nowrap;
}

.search-container {
  flex: 1;
  max-width: 700px;
  position: relative;
}

.search-box {
  display: flex;
  align-items: center;
  border: 1px solid #dfe1e5;
  border-radius: 24px;
  padding: 0 16px;
  height: 44px;
  transition: all 0.2s;
  background: #fff;
}

.search-box:hover {
  box-shadow: 0 1px 6px rgba(32,33,36,.28);
  border-color: rgba(223,225,229,0);
}

.search-box:focus-within {
  box-shadow: 0 1px 6px rgba(32,33,36,.28);
  border-color: rgba(223,225,229,0);
}

.search-icon {
  width: 20px;
  height: 20px;
  margin-right: 12px;
  opacity: 0.6;
}

.search-box input {
  flex: 1;
  border: none;
  outline: none;
  font-size: 16px;
  font-family: 'Roboto', sans-serif;
  background: transparent;
}

.clear-btn, .voice-btn {
  padding: 8px;
  cursor: pointer;
  opacity: 0.6;
  transition: opacity 0.2s;
  background: none;
  border: none;
  display: flex;
  align-items: center;
}

.clear-btn:hover, .voice-btn:hover {
  opacity: 1;
}

.tools-btn {
  padding: 8px 16px;
  border: none;
  background: transparent;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  color: #5f6368;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: background 0.2s;
}

.tools-btn:hover {
  background: #f1f3f4;
}

/* Tabs */
.tabs-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 30px;
  border-bottom: 1px solid #dadce0;
}

.tabs {
  display: flex;
  gap: 4px;
  padding-top: 8px;
}

.tab {
  padding: 12px 16px;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 14px;
  color: #5f6368;
  border-bottom: 3px solid transparent;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}

.tab:hover {
  color: #202124;
}

.tab.active {
  color: #1a73e8;
  border-bottom-color: #1a73e8;
}

/* Results */
.results-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px 30px;
}

.results-info {
  font-size: 14px;
  color: #70757a;
  margin-bottom: 20px;
}

/* Web Results */
.result {
  margin-bottom: 28px;
  max-width: 600px;
}

.result-url-container {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 2px;
}

.result-favicon {
  width: 18px;
  height: 18px;
  border-radius: 50%;
}

.result-url {
  font-size: 14px;
  color: #202124;
  text-decoration: none;
}

.result-breadcrumb {
  font-size: 14px;
  color: #5f6368;
  margin-left: 4px;
}

.result-title {
  font-size: 20px;
  color: #1a0dab;
  text-decoration: none;
  display: block;
  margin-bottom: 4px;
  cursor: pointer;
  line-height: 1.3;
}

.result-title:hover {
  text-decoration: underline;
}

.result-title:visited {
  color: #681da8;
}

.result-desc {
  font-size: 14px;
  color: #4d5156;
  line-height: 1.58;
}

/* Image Grid */
.image-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  gap: 16px;
  padding: 8px 0;
}

.image-card {
  cursor: pointer;
  border-radius: 12px;
  overflow: hidden;
  transition: transform 0.2s;
  background: #f8f9fa;
}

.image-card:hover {
  transform: translateY(-2px);
}

.image-wrapper {
  width: 100%;
  padding-bottom: 100%;
  position: relative;
  overflow: hidden;
  background: #f1f3f4;
}

.image-wrapper img {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.image-info {
  padding: 12px;
  background: #fff;
}

.image-title {
  font-size: 14px;
  color: #202124;
  margin-bottom: 4px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.image-source {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: #5f6368;
}

.image-source img {
  width: 14px;
  height: 14px;
  border-radius: 50%;
}

/* Video Results */
.video-card {
  display: flex;
  gap: 16px;
  margin-bottom: 20px;
  cursor: pointer;
  max-width: 800px;
}

.video-card:hover .video-title {
  text-decoration: underline;
}

.video-thumbnail-wrapper {
  position: relative;
  width: 246px;
  height: 138px;
  flex-shrink: 0;
  border-radius: 8px;
  overflow: hidden;
  background: #000;
}

.video-thumbnail {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.video-duration {
  position: absolute;
  bottom: 6px;
  right: 6px;
  background: rgba(0,0,0,0.8);
  color: #fff;
  padding: 2px 6px;
  border-radius: 2px;
  font-size: 12px;
  font-weight: 500;
}

.video-info {
  flex: 1;
}

.video-title {
  font-size: 18px;
  color: #1a0dab;
  margin-bottom: 6px;
  line-height: 1.3;
}

.video-meta {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
}

.video-meta img {
  width: 16px;
  height: 16px;
  border-radius: 50%;
}

.video-meta-text {
  font-size: 13px;
  color: #5f6368;
}

.video-desc {
  font-size: 14px;
  color: #4d5156;
  line-height: 1.58;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Files */
.file-card {
  display: flex;
  gap: 12px;
  padding: 16px;
  border: 1px solid #dadce0;
  border-radius: 8px;
  margin-bottom: 12px;
  max-width: 600px;
  transition: all 0.2s;
}

.file-card:hover {
  box-shadow: 0 1px 6px rgba(32,33,36,.28);
  border-color: rgba(223,225,229,0);
}

.file-icon {
  width: 40px;
  height: 40px;
  background: #1a73e8;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-weight: 600;
  font-size: 12px;
  flex-shrink: 0;
}

.file-info {
  flex: 1;
}

.file-title {
  font-size: 16px;
  color: #1a0dab;
  text-decoration: none;
  display: block;
  margin-bottom: 4px;
}

.file-title:hover {
  text-decoration: underline;
}

.file-meta {
  font-size: 13px;
  color: #5f6368;
  display: flex;
  align-items: center;
  gap: 12px;
}

.download-btn {
  padding: 8px 16px;
  background: #1a73e8;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.2s;
}

.download-btn:hover {
  background: #1765cc;
}

/* Modal */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.9);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  padding: 20px;
}

.modal.active {
  display: flex;
}

.modal-content {
  max-width: 90vw;
  max-height: 90vh;
  position: relative;
}

.modal-img {
  max-width: 100%;
  max-height: 85vh;
  display: block;
  border-radius: 8px;
}

.modal-info {
  background: #fff;
  padding: 16px;
  border-radius: 0 0 8px 8px;
  max-width: 100%;
}

.modal-title {
  font-size: 16px;
  color: #202124;
  margin-bottom: 8px;
}

.modal-source {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #5f6368;
  margin-bottom: 12px;
}

.modal-source img {
  width: 16px;
  height: 16px;
  border-radius: 50%;
}

.modal-actions {
  display: flex;
  gap: 12px;
}

.modal-btn {
  padding: 8px 16px;
  border: 1px solid #dadce0;
  background: #fff;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.2s;
}

.modal-btn:hover {
  background: #f8f9fa;
}

.close-modal {
  position: absolute;
  top: -40px;
  right: 0;
  background: none;
  border: none;
  color: #fff;
  font-size: 32px;
  cursor: pointer;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background 0.2s;
}

.close-modal:hover {
  background: rgba(255,255,255,0.1);
}

/* No Results */
.no-results {
  padding: 60px 20px;
  text-align: center;
}

.no-results-title {
  font-size: 20px;
  color: #202124;
  margin-bottom: 12px;
}

.no-results-desc {
  font-size: 14px;
  color: #5f6368;
  margin-bottom: 20px;
}

.suggestions {
  text-align: left;
  max-width: 500px;
  margin: 0 auto;
}

.suggestions li {
  margin-bottom: 8px;
  color: #5f6368;
  font-size: 14px;
}

/* Loading */
.loading {
  text-align: center;
  padding: 40px;
  font-size: 14px;
  color: #5f6368;
}

/* Filter Pills */
.filter-pills {
  display: flex;
  gap: 8px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.filter-pill {
  padding: 8px 16px;
  background: #f1f3f4;
  border: none;
  border-radius: 16px;
  cursor: pointer;
  font-size: 13px;
  color: #3c4043;
  transition: all 0.2s;
}

.filter-pill:hover {
  background: #e8eaed;
}

.filter-pill.active {
  background: #1a73e8;
  color: #fff;
}

/* Responsive */
@media (max-width: 768px) {
  .header-content {
    flex-wrap: wrap;
  }
  
  .search-container {
    order: 3;
    width: 100%;
    max-width: 100%;
  }
  
  .image-grid {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 8px;
  }
  
  .video-card {
    flex-direction: column;
  }
  
  .video-thumbnail-wrapper {
    width: 100%;
  }
}
</style>
</head>
<body>

<header>
  <div class="header-content">
    <div class="logo" onclick="resetSearch()">Aearch</div>
    <div class="search-container">
      <div class="search-box">
        <svg class="search-icon" focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path fill="#5f6368" d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
        </svg>
        <input type="text" id="searchInput" placeholder="Search" oninput="handleSearch()" onkeypress="handleKeyPress(event)">
        <button class="clear-btn" id="clearBtn" onclick="clearSearch()" style="display: none;">
          <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
            <path fill="#70757a" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
          </svg>
        </button>
        <button class="voice-btn">
          <svg focusable="false" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20">
            <path fill="#4285f4" d="M12 15c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v7c0 1.66 1.34 3 3 3zm5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 15 6.7 12H5c0 3.41 2.72 6.23 6 6.72V22h2v-3.28c3.28-.48 6-3.3 6-6.72h-1.7z"></path>
          </svg>
        </button>
      </div>
    </div>
    <button class="tools-btn">
      <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
        <path d="M7 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5zM8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
      </svg>
      Tools
    </button>
  </div>
</header>

<div class="tabs-container">
  <div class="tabs">
    <button class="tab active" data-mode="all" onclick="switchTab('all')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M10 2v2a6 6 0 0 1 6 6h2a8 8 0 0 0-8-8z"/>
        <path d="M10 4V2a8 8 0 0 0-8 8h2a6 6 0 0 1 6-6z"/>
        <path d="M4 10H2a8 8 0 0 0 8 8v-2a6 6 0 0 1-6-6z"/>
        <path d="M22 10h-2a6 6 0 0 1-6 6v2a8 8 0 0 0 8-8z"/>
      </svg>
      All
    </button>
    <button class="tab" data-mode="images" onclick="switchTab('images')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
      </svg>
      Images
    </button>
    <button class="tab" data-mode="videos" onclick="switchTab('videos')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M10 8.64L15.27 12 10 15.36V8.64M8 5v14l11-7L8 5z"/>
      </svg>
      Videos
    </button>
    <button class="tab" data-mode="files" onclick="switchTab('files')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
      </svg>
      Files
    </button>
  </div>
</div>

<div class="results-container">
  <div id="resultsInfo" class="results-info"></div>
  <div id="filterPills" class="filter-pills"></div>
  <div id="results"></div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="modal" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <button class="close-modal" onclick="closeModal()">×</button>
    <img id="modalImage" class="modal-img" alt="">
    <div class="modal-info">
      <div id="modalTitle" class="modal-title"></div>
      <div id="modalSource" class="modal-source"></div>
      <div class="modal-actions">
        <button class="modal-btn" onclick="visitSource()">Visit Page</button>
        <button class="modal-btn" onclick="viewImage()">View Image</button>
      </div>
    </div>
  </div>
</div>

<script>
let MODE = "all";
let PAGES = [];
let IMAGES = [];
let VIDEOS = [];
let FILES = [];
let currentQuery = "";
let currentImageData = null;

// Load data
async function loadData() {
  try {
    PAGES = Object.values(await (await fetch("data.json")).json());
    IMAGES = await (await fetch("images.json")).json();
    VIDEOS = await (await fetch("videos.json")).json();
    FILES = await (await fetch("files.json")).json();
  } catch (e) {
    console.error("Error loading data:", e);
  }
}

// Initialize
loadData();

// Search handling
function handleSearch() {
  const input = document.getElementById("searchInput");
  const clearBtn = document.getElementById("clearBtn");
  currentQuery = input.value.trim();
  
  clearBtn.style.display = currentQuery ? "flex" : "none";
  
  if (currentQuery) {
    performSearch();
  } else {
    document.getElementById("results").innerHTML = "";
    document.getElementById("resultsInfo").textContent = "";
  }
}

function handleKeyPress(e) {
  if (e.key === "Enter") {
    performSearch();
  }
}

function clearSearch() {
  document.getElementById("searchInput").value = "";
  document.getElementById("clearBtn").style.display = "none";
  document.getElementById("results").innerHTML = "";
  document.getElementById("resultsInfo").textContent = "";
  currentQuery = "";
}

function resetSearch() {
  clearSearch();
  switchTab("all");
}

// Tab switching
function switchTab(mode) {
  MODE = mode;
  document.querySelectorAll(".tab").forEach(tab => {
    tab.classList.toggle("active", tab.dataset.mode === mode);
  });
  
  if (currentQuery) {
    performSearch();
  }
}

// Tokenization
function tokens(s) {
  return s.toLowerCase().split(/\W+/).filter(x => x.length > 0);
}

// Scoring functions
function tokenMatchScore(text, queryTokens) {
  if (!text) return 0;
  text = text.toLowerCase();
  let score = 0;
  for (const qt of queryTokens) {
    if (text.includes(qt)) {
      score += (qt.length <= 2 ? 5 : 10);
    } else {
      const words = text.split(/\W+/);
      for (const w of words) {
        if (w.startsWith(qt) || qt.startsWith(w)) {
          score += (qt.length <= 2 ? 3 : 6);
          break;
        }
      }
    }
  }
  return score;
}

function scoreWeb(p, q) {
  const qt = tokens(q);
  if (qt.length === 0) return 0;
  let score = 0;
  for (const t of qt) {
    score += tokenMatchScore(p.title || "", [t]) * 10;
    score += tokenMatchScore(p.description || "", [t]) * 2;
    score += tokenMatchScore(p.url || "", [t]) * 6;
  }
  if (p.pagerank) score += p.pagerank * 20;
  const qstr = q.toLowerCase();
  if ((p.title || "").toLowerCase().includes(qstr)) score += 500;
  if ((p.url || "").toLowerCase().includes(qstr)) score += 300;
  return score;
}

function scoreImage(i, q) {
  const qt = tokens(q);
  let score = 0;
  for (const t of qt) {
    if (t.length <= 2) {
      if ((i.img_title || "").toLowerCase().includes(t)) score += 5;
      if ((i.page_title || "").toLowerCase().includes(t)) score += 3;
    } else {
      score += tokenMatchScore(i.img_title || "", [t]) * 10;
      score += tokenMatchScore(i.page_title || "", [t]) * 4;
      score += tokenMatchScore(i.page_url || "", [t]) * 2;
    }
  }
  return score;
}

function scoreVideo(v, q) {
  const qt = tokens(q);
  let score = 0;
  for (const t of qt) {
    if (t.length <= 2) {
      if ((v.video_title || "").toLowerCase().includes(t)) score += 5;
      if ((v.page_title || "").toLowerCase().includes(t)) score += 3;
    } else {
      score += tokenMatchScore(v.video_title || "", [t]) * 10;
      score += tokenMatchScore(v.page_title || "", [t]) * 4;
    }
  }
  return score;
}

function scoreFile(f, q) {
  const qt = tokens(q);
  let score = 0;
  for (const t of qt) {
    if (t.length <= 2) {
      if ((f.file_title || "").toLowerCase().includes(t)) score += 5;
      if ((f.page_title || "").toLowerCase().includes(t)) score += 3;
    } else {
      score += tokenMatchScore(f.file_title || "", [t]) * 10;
      score += tokenMatchScore(f.page_title || "", [t]) * 4;
    }
  }
  return score;
}

// Perform search
function performSearch() {
  const results = document.getElementById("results");
  const resultsInfo = document.getElementById("resultsInfo");
  
  if (!currentQuery) {
    results.innerHTML = "";
    resultsInfo.textContent = "";
    return;
  }
  
  results.innerHTML = '<div class="loading">Searching...</div>';
  
  setTimeout(() => {
    if (MODE === "all") {
      searchAll();
    } else if (MODE === "images") {
      searchImages();
    } else if (MODE === "videos") {
      searchVideos();
    } else if (MODE === "files") {
      searchFiles();
    }
  }, 100);
}

// Search All
function searchAll() {
  const results = document.getElementById("results");
  const resultsInfo = document.getElementById("resultsInfo");
  results.innerHTML = "";
  
  let scored = [];
  for (const p of PAGES) {
    const s = scoreWeb(p, currentQuery);
    if (s > 0) scored.push({ p, s });
  }
  scored.sort((a, b) => b.s - a.s);
  
  if (scored.length === 0) {
    showNoResults();
    return;
  }
  
  resultsInfo.textContent = `About ${scored.length.toLocaleString()} results`;
  
  const seenDomains = new Set();
  for (const r of scored) {
    const p = r.p;
    const url = new URL(p.url);
    const domain = url.hostname.replace('www.', '');
    
    if (seenDomains.has(domain)) continue;
    seenDomains.add(domain);
    
    const result = document.createElement("div");
    result.className = "result";
    
    const breadcrumb = url.pathname.split('/').filter(x => x).slice(0, 2).join(' › ');
    
    result.innerHTML = `
      <div class="result-url-container">
        <img class="result-favicon" src="${p.favicon || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><circle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ddd%22/></svg>'}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><circle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ddd%22/></svg>'">
        <span class="result-url">${domain}</span>
        ${breadcrumb ? `<span class="result-breadcrumb">› ${breadcrumb}</span>` : ''}
      </div>
      <a href="${p.url}" target="_blank" class="result-title">${p.title || p.url}</a>
      <div class="result-desc">${p.description || ''}</div>
    `;
    
    results.appendChild(result);
    
    if (seenDomains.size >= 20) break;
  }
}

// Search Images
function searchImages() {
  const results = document.getElementById("results");
  const resultsInfo = document.getElementById("resultsInfo");
  results.innerHTML = "";
  
  let scored = [];
  for (const i of IMAGES) {
    const s = scoreImage(i, currentQuery);
    if (s > 0) scored.push({ i, s });
  }
  scored.sort((a, b) => b.s - a.s);
  
  if (scored.length === 0) {
    showNoResults();
    return;
  }
  
  resultsInfo.textContent = `About ${scored.length.toLocaleString()} image results`;
  
  const grid = document.createElement("div");
  grid.className = "image-grid";
  
  const seenDomains = new Set();
  for (const r of scored) {
    const i = r.i;
    const domain = new URL(i.page_url).hostname.replace('www.', '');
    
    if (seenDomains.has(domain)) continue;
    seenDomains.add(domain);
    
    const card = document.createElement("div");
    card.className = "image-card";
    card.innerHTML = `
      <div class="image-wrapper">
        <img src="${i.img_url}" alt="${i.img_title || ''}" loading="lazy">
      </div>
      <div class="image-info">
        <div class="image-title">${i.img_title || i.page_title || 'Untitled'}</div>
        <div class="image-source">
          <img src="${i.page_favicon || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><circle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ddd%22/></svg>'}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><circle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ddd%22/></svg>'">
          <span>${domain}</span>
        </div>
      </div>
    `;
    
    card.onclick = () => openImageModal(i);
    grid.appendChild(card);
    
    if (seenDomains.size >= 40) break;
  }
  
  results.appendChild(grid);
}

// Search Videos
function searchVideos() {
  const results = document.getElementById("results");
  const resultsInfo = document.getElementById("resultsInfo");
  results.innerHTML = "";
  
  let scored = [];
  for (const v of VIDEOS) {
    const s = scoreVideo(v, currentQuery);
    if (s > 0) scored.push({ v, s });
  }
  scored.sort((a, b) => b.s - a.s);
  
  if (scored.length === 0) {
    showNoResults();
    return;
  }
  
  resultsInfo.textContent = `About ${scored.length.toLocaleString()} video results`;
  
  const seenDomains = new Set();
  for (const r of scored) {
    const v = r.v;
    const domain = new URL(v.page_url).hostname.replace('www.', '');
    
    if (seenDomains.has(domain)) continue;
    seenDomains.add(domain);
    
    const card = document.createElement("div");
    card.className = "video-card";
    card.onclick = () => window.open(v.video_url, '_blank');
    
    card.innerHTML = `
      <div class="video-thumbnail-wrapper">
        <img class="video-thumbnail" src="${v.thumbnail || ''}" alt="${v.video_title || ''}">
        <span class="video-duration">12:34</span>
      </div>
      <div class="video-info">
        <div class="video-title">${v.video_title || v.page_title || 'Untitled Video'}</div>
        <div class="video-meta">
          <img src="${v.page_favicon || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><circle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ddd%22/></svg>'}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><circle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ddd%22/></svg>'">
          <span class="video-meta-text">${domain}</span>
        </div>
        <div class="video-desc">${v.page_title || 'Watch this video'}</div>
      </div>
    `;
    
    results.appendChild(card);
    
    if (seenDomains.size >= 20) break;
  }
}

// Search Files
function searchFiles() {
  const results = document.getElementById("results");
  const resultsInfo = document.getElementById("resultsInfo");
  results.innerHTML = "";
  
  let scored = [];
  for (const f of FILES) {
    const s = scoreFile(f, currentQuery);
    if (s > 0) scored.push({ f, s });
  }
  scored.sort((a, b) => b.s - a.s);
  
  if (scored.length === 0) {
    showNoResults();
    return;
  }
  
  resultsInfo.textContent = `About ${scored.length.toLocaleString()} file results`;
  
  const seenDomains = new Set();
  for (const r of scored) {
    const f = r.f;
    const domain = new URL(f.page_url).hostname.replace('www.', '');
    
    if (seenDomains.has(domain)) continue;
    seenDomains.add(domain);
    
    const ext = f.file_url.split('.').pop().toUpperCase().substring(0, 4);
    
    const card = document.createElement("div");
    card.className = "file-card";
    card.innerHTML = `
      <div class="file-icon">${ext}</div>
      <div class="file-info">
        <a href="${f.file_url}" target="_blank" class="file-title">${f.file_title || f.file_url}</a>
        <div class="file-meta">
          <span>${domain}</span>
          <span>•</span>
          <span>${ext} file</span>
        </div>
      </div>
      <button class="download-btn" onclick="event.stopPropagation(); window.open('${f.file_url}', '_blank')">
        Download
      </button>
    `;
    
    results.appendChild(card);
    
    if (seenDomains.size >= 20) break;
  }
}

// Image Modal
function openImageModal(imageData) {
  currentImageData = imageData;
  const modal = document.getElementById("imageModal");
  const modalImg = document.getElementById("modalImage");
  const modalTitle = document.getElementById("modalTitle");
  const modalSource = document.getElementById("modalSource");
  
  modalImg.src = imageData.img_url;
  modalTitle.textContent = imageData.img_title || imageData.page_title || 'Untitled';
  
  const domain = new URL(imageData.page_url).hostname.replace('www.', '');
  modalSource.innerHTML = `
    <img src="${imageData.page_favicon || 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 24 24%22><circle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ddd%22/></svg>'}">
    <span>${domain}</span>
  `;
  
  modal.classList.add("active");
}

function closeModal() {
  document.getElementById("imageModal").classList.remove("active");
}

function visitSource() {
  if (currentImageData) {
    window.open(currentImageData.page_url, '_blank');
  }
}

function viewImage() {
  if (currentImageData) {
    window.open(currentImageData.img_url, '_blank');
  }
}

// No Results
function showNoResults() {
  const results = document.getElementById("results");
  const resultsInfo = document.getElementById("resultsInfo");
  
  resultsInfo.textContent = "";
  
  results.innerHTML = `
    <div class="no-results">
      <div class="no-results-title">No results found for "${currentQuery}"</div>
      <div class="no-results-desc">Try different keywords or check your spelling</div>
      <div class="suggestions">
        <p style="font-weight: 500; margin-bottom: 8px;">Suggestions:</p>
        <ul>
          <li>Make sure all words are spelled correctly</li>
          <li>Try different keywords</li>
          <li>Try more general keywords</li>
          <li>Try fewer keywords</li>
        </ul>
      </div>
    </div>
  `;
}

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  if (e.key === '/' && document.activeElement.tagName !== 'INPUT') {
    e.preventDefault();
    document.getElementById('searchInput').focus();
  }
  
  if (e.key === 'Escape') {
    if (document.getElementById('imageModal').classList.contains('active')) {
      closeModal();
    }
  }
});
</script>

</body>
</html>
